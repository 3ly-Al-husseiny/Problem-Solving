/* Write your T-SQL query statement below */
-- first query: user with most movie ratings
with user_ratings as (
    select u.name,
           count(mr.movie_id) as rating_count,
           row_number() over (order by count(mr.movie_id) desc, u.name) as rn
    from users u
    join movierating mr on u.user_id = mr.user_id
    group by u.user_id, u.name
),
movie_ratings as (
    select m.title,
           avg(mr.rating * 1.0) as avg_rating,
           row_number() over (order by avg(mr.rating * 1.0) desc, m.title) as rn
    from movies m
    join movierating mr on m.movie_id = mr.movie_id
    where year(mr.created_at) = 2020 and month(mr.created_at) = 2
    group by m.movie_id, m.title
)
select name as results from user_ratings where rn = 1
union all
select title as results from movie_ratings where rn = 1;